------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\faith\Downloads\ps2_ray.log
  log type:  text
 opened on:  20 Feb 2019, 12:57:08
. 
. 
. /* Question 1: Propensity Score Matching
> 
> Load in the data using the command: webuse cattaneo2, clear. */
. 
. webuse cattaneo2, clear
(Excerpt from Cattaneo (2010) Journal of Econometrics 155: 138-154)

. 
. /* Q1, a) Compute the eﬀect of whether or not a mother smoked during pregnancy 
> (mbsmoke) on birthweight (bweight), controlling for an indicator for married, 
> an indicator for the baby being the ﬁrst baby, mother being white, a quadratic 
> function of a mother’s age, mother’s years of education, mother’s years of education 
> squared, and an indicator for whether or not the mother drank alcohol during the 
> pregnancy.*/
. 
. gen magesq = mage^2

. gen medusq = medu^2

. regress bweight mbsmoke mmarried fbaby mrace mage magesq medu medusq alcohol

      Source |       SS           df       MS      Number of obs   =     4,642
-------------+----------------------------------   F(9, 4632)      =     46.43
       Model |   128656468         9  14295163.1   Prob > F        =    0.0000
    Residual |  1.4262e+09     4,632  307907.549   R-squared       =    0.0827
-------------+----------------------------------   Adj R-squared   =    0.0810
       Total |  1.5549e+09     4,641  335032.156   Root MSE        =    554.89

------------------------------------------------------------------------------
     bweight |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     mbsmoke |   -238.346   22.22063   -10.73   0.000     -281.909    -194.783
    mmarried |   65.58488   23.00792     2.85   0.004     20.47839    110.6914
       fbaby |   -72.2636   17.87146    -4.04   0.000    -107.3002   -37.22702
       mrace |   277.6158   24.58421    11.29   0.000      229.419    325.8125
        mage |   3.233071   12.35633     0.26   0.794    -20.99121    27.45736
      magesq |   -.057435   .2198574    -0.26   0.794    -.4884602    .3735903
        medu |  -9.582647   12.67904    -0.76   0.450    -34.43961    15.27432
      medusq |   .7202726   .5520688     1.30   0.192    -.3620452     1.80259
     alcohol |  -26.06735   46.99097    -0.55   0.579     -118.192    66.05732
       _cons |   3116.795   175.9508    17.71   0.000     2771.848    3461.743
------------------------------------------------------------------------------

. 
. estimates store ols

. 
. /* Q1 b) Why might you be worried about interpreting the coeﬃcient on the eﬀect 
> of the mother’s smoking status as a truly causal relationship? Explain.
> 
> We might not be able to construct a counterfactual appropriately using OLS due to 
> treatment endogeneity. Thus, if selection bias is determined by observed characteristics
> and there are no unobserved causes of selection bias, we can use propensity score matching 
> to first predict treatment using either a logit or probit regression model, find matches using
>  
> the probabilities of treatment within a certain range as comparable indexes, and construct
> counterfactuals for treated observations from control group observations with similar 
> index scores. OLS, in other words, would only provide the ATE since we would be taking 
> averages of the treatment effect across all groups without controlling for probability
> of being in the treatment group.
> 
> */
. 
. /*Q1 c) Use propensity score matching to answer estimate the eﬀect of whether or 
> not a mother smoked during pregnancy on birthweight, controlling for the exact same 
> set of control variables. */
. 
. teffects psmatch (bweight) (mbsmoke mmarried fbaby mrace mage magesq medu medusq alcohol)

Treatment-effects estimation                   Number of obs      =      4,642
Estimator      : propensity-score matching     Matches: requested =          1
Outcome model  : matching                                     min =          1
Treatment model: logit                                        max =         70
----------------------------------------------------------------------------------------
                       |              AI Robust
               bweight |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------------+----------------------------------------------------------------
ATE                    |
               mbsmoke |
(smoker vs nonsmoker)  |  -214.4008   31.24434    -6.86   0.000    -275.6386    -153.163
----------------------------------------------------------------------------------------

. estimates store ate

. teffects psmatch (bweight) (mbsmoke mmarried fbaby mrace mage magesq medu medusq alcohol), ate
> t

Treatment-effects estimation                   Number of obs      =      4,642
Estimator      : propensity-score matching     Matches: requested =          1
Outcome model  : matching                                     min =          1
Treatment model: logit                                        max =         70
----------------------------------------------------------------------------------------
                       |              AI Robust
               bweight |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------------+----------------------------------------------------------------
ATET                   |
               mbsmoke |
(smoker vs nonsmoker)  |  -250.8147   27.98471    -8.96   0.000    -305.6638   -195.9657
----------------------------------------------------------------------------------------

. estimates store atet

. /*Do these results diﬀer substantially from the regression results in question 1a?*/
. 
. estimates table ols ate atet, se t p

-----------------------------------------------------
    Variable |    ols          ate          atet     
-------------+---------------------------------------
_            |
     mbsmoke | -238.34599                            
             |  22.220635                            
             |     -10.73                            
             |     0.0000                            
    mmarried |  65.584884                            
             |  23.007924                            
             |       2.85                            
             |     0.0044                            
       fbaby |   -72.2636                            
             |  17.871465                            
             |      -4.04                            
             |     0.0001                            
       mrace |  277.61578                            
             |   24.58421                            
             |      11.29                            
             |     0.0000                            
        mage |  3.2330712                            
             |  12.356327                            
             |       0.26                            
             |     0.7936                            
      magesq | -.05743496                            
             |  .21985741                            
             |      -0.26                            
             |     0.7939                            
        medu | -9.5826474                            
             |  12.679045                            
             |      -0.76                            
             |     0.4498                            
      medusq |  .72027256                            
             |   .5520688                            
             |       1.30                            
             |     0.1921                            
     alcohol | -26.067353                            
             |  46.990968                            
             |      -0.55                            
             |     0.5791                            
       _cons |  3116.7953                            
             |  175.95076                            
             |      17.71                            
             |     0.0000                            
-------------+---------------------------------------
ATE          |
     mbsmoke |
    (smoker  |
         vs  |
 nonsmoker)  |              -214.40079               
             |               31.244344               
             |                   -6.86               
             |                  0.0000               
-------------+---------------------------------------
ATET         |
     mbsmoke |
    (smoker  |
         vs  |
 nonsmoker)  |                           -250.81474  
             |                            27.984707  
             |                                -8.96  
             |                               0.0000  
-----------------------------------------------------
                                     legend: b/se/t/p

. 
. /* OLS provided the most efficient standard errors, and when we ran the psmatch, 
> ATE provided the largest standard errors. ATET standard errors improved from ATE.
> 
> ATE provided the lowest absolute value of the the treatment effect. ATET provided the highest
> absolute value of the treatment effect. OLS coefficient was between that of ATE and ATET. 
> 
> All estimates of the treatment effect were reported significant at the .01 level although 
> OLS reported a higher absolute value of the T score with ATET following with the second highes
> t 
> absolute value of the Tscore. ATE reported the lowest absolute value of the tscore. 
> 
> Overall, ATET was closer to the treatment results reported in the OLS regression 
> while ATE was outside of the initial confidence interval for the OLS reported 
> treatment effect.*/
. 
. /*Q1 d) Re-run the teffects psmatch command, adding at the end of the command after 
> the comma gen(pscore). */
. 
. teffects psmatch (bweight) (mbsmoke mmarried fbaby mrace mage magesq medu medusq alcohol), ate
> t gen(pscore)

Treatment-effects estimation                   Number of obs      =      4,642
Estimator      : propensity-score matching     Matches: requested =          1
Outcome model  : matching                                     min =          1
Treatment model: logit                                        max =         70
----------------------------------------------------------------------------------------
                       |              AI Robust
               bweight |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------------+----------------------------------------------------------------
ATET                   |
               mbsmoke |
(smoker vs nonsmoker)  |  -250.8147   27.98471    -8.96   0.000    -305.6638   -195.9657
----------------------------------------------------------------------------------------

. 
. /*Now run the command teffects overlap to see the common support graph.*/ 
. 
. teffects overlap

. 
. /*Save the graph using the command graph export <lastname>.pdf, replace and upload the 
> graph separately to ELMS. */
. 
. graph export ray.pdf, replace
(file ray.pdf written in PDF format)

. 
. /*Is there much overlap between the smoking and non-smoking groups? Why does this matter? 
> */
. 
. /*There seems to be sufficient overlap between smoking and non-smoking groups. We want
> common support in order to perform the matching and build a counterfactual. Without
> common support, we don't have sufficient explanatory power over treatment selection 
> to remove selection bias using propensity-score matching.*/
. 
. /*Q1 e) How does propensity-score matching allow for the separate calculation of the ATE and A
> TET?*/
. 
. /* In nonexperimental data without random assignment, as long as there is sufficient common su
> pport, 
> propensity score matching allows us to compare treated and control observations based on 
> selection on observables to estimate counterfactuals. This allows us to calculate both the 
> ATE and the ATET by removing selection bias from the ATE. */
. 
. /*Q1 f) What advantages does propensity score matching have over exact cell matching, 
> particularly when the number of covariates is high? 
> 
> Because exact cell matching suffers from the "curse of dimensionality," propensity score
> matching provides a method to match observations for comparison when there are a large
> number of covariates acting as qualifying parameters. As the number of qualifying 
> parameters increases, the number of possible matches decreases. Propensity scores
> turn determinants for treatment into a likelihood estimator. Thus, the propensity-score method
>  
> compares observations with the same likelihood of treatment, increasing the number of potentia
> l 
> matches from the possibilities in exact cell matching.*/
. 
. log close
      name:  <unnamed>
       log:  C:\Users\faith\Downloads\ps2_ray.log
  log type:  text
 closed on:  20 Feb 2019, 12:57:23
------------------------------------------------------------------------------------------------
 
